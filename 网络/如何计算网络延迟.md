​	

# 介绍

**时延**：是数据（一个报文或分组，甚至比特）从网络或链路的一端，传送到另一端所需要的时间，一般指**单向传播**。<br/>
**发送时延**：是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。<br/>
	发送时延=数据帧长度(b) /信道带宽(b/s) [信道带宽就是数据率]<br/>
**传播时延**：电磁波在信道中需要传播一定的距离而花费的时间。<br/>
	传播时延=信道长度(m)/电磁波在信道上的传播速率(m/s)<br/>
**处理时延**：主机或路由器处理所收到的分组的时间。<br/>
**排队时延**：分组在输入队列中排队等待处理，在输出队列中等待转发，就形成了排队时延。<br/>
**总时延**=发送时延+传播时延+处理时延+排队时延。

本文以“SAN网络存储”为例，主要介绍**传播时延**的粗略计算方式。

SAN网络存储是企业存储架构的中坚力量，大部分企业关键应用后端存储都采用SAN网络连接。为了更好服务器密集IO的企业关键应用，以及日益普及的企业应用异地灾备的需求。有效评估SAN延迟对规划、管理SAN网络性能有着至关重要的作用，今天主要给家介绍SAN网络主要延迟类型（主要包括链路延迟和交换机延迟，主机延迟和存储延迟不包含），不同延迟计算方法，以及SCSI Read和SCSI Write操作延迟对比。

# 网络延迟

**延迟类型**

SAN网络存储类型主要包括：主机延迟、链路延迟、交换机延迟、存储延迟，其中SAN网络主要覆盖链路延迟和交换机延迟这两种类型。

**延迟计算方法**

**链路延迟**

链路延迟是光信号在FC链路上传输所需要的时间，计算公式=距离/光速，由于光是通过反射传输，因此需要通过直线距离和反射系数来计算光经过距离，反射系数通常都取1.538。因此1米距离对应的延迟=1.538/(299,792,458m/s) =~ 5ns。

因此**链路延迟 = 5ns * 距离**

**交换机延迟**

交换机延迟直接反应交换机性能，主要收到交换机ASIC影响，不同厂商、不同型号交换机延迟不一样；另外交换机延迟还需要考虑Fabric拥塞的情况。正常情况下，交换机延迟范围在600ns-20us；Brocade最新型号的Condor 3 ASIC的F_Port to F_Port延迟是800ns，E_Port to E_Port延迟是1.2us。如果Fabrci发生拥塞情况下，交换机延迟取决于Hold Timer，通常配置在500ms-2000ms之间。

EMC推荐SAN网络每条链路不超过3条（4个交换机），过多交换机级联不但增加SAN网络复杂性，而且会增加链路延迟导致性能下降。

# 引用

- 《[如何有效评估SAN网络延迟](https://www.dell.com/community/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%92%8C%E4%BF%9D%E6%8A%A4-%E8%B5%84%E6%96%99%E6%96%87%E6%A1%A3/%E5%A6%82%E4%BD%95%E6%9C%89%E6%95%88%E8%AF%84%E4%BC%B0SAN%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F-latency/ta-p/7184579)》